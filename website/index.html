<!DOCTYPE html>
<html lang="en">

<head>
    <title>ArXiv Analytics</title>
    <meta charset="utf-8">
    <style>
        .dark-theme {
            background-color: #292929;
            color: white;
        }

        img {
            max-width: 100%;
        }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://kit.fontawesome.com/6c81dcd856.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
        crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

</head>

<body>
    <div class="container">

        <div class="row justify-content-between mt-3">
            <div class="col-auto">
                <h5>github:
                    <a href="https://github.com/vanchanr/arXiv-analytics" target="_blank">arXiv-analytics</a>
                </h5>
            </div>
            <div class="col-auto align-self-center form-check form-switch">
                <input class="form-check-input" type="checkbox" id="darkTheme">
                <label class="form-check-label" for="darkTheme">Dark Theme</label>
            </div>
        </div>

        <div class="row justify-content-center mt-5">
            <div class="col-auto">
                <span class="input-group-text">Enter Keyword</span>
            </div>
            <div class="col-auto">
                <input class="form-control" type="text" id="enterKeyword" placeholder="ex: Blockchain">
            </div>
            <div class="col-auto">
                <button class="btn btn-primary" type="button" id="submitKeyword">submit</button>
            </div>
        </div>

        <div class="row justify-content-center mt-3">
            <div class="col-auto fa-2x" id="status">
            </div>
        </div>

        <div class="row justify-content-center mt-3">
            <div class="col-4">
                <img id="yearPlot" src="" alt="yearPlot">
            </div>
            <div class="col-4">
                <img id="authorPlot" src="" alt="authorPlot">
            </div>
            <div class="col-4">
                <img id="categoryPlot" src="" alt="categoryPlot">
            </div>
        </div>

        <div class="row justify-content-center mt-3">
            <div class="col-auto">
                <pre class="text-monospace" id="response"></pre>
            </div>
        </div>

    </div>

    <script>
        invokeUrl = 'https://n3z996amkk.execute-api.ap-south-1.amazonaws.com/dev';

        $(document).ajaxStart($.blockUI).ajaxStop($.unblockUI);

        function showLoading() {
            $("#status").html('<i class="fas fa-circle-notch fa-spin"></i>').css("color", "#0d6efd");
        };

        function showSuccess() {
            $("#status").html('<i class="fas fa-check"></i>').css("color", "green");
        }

        function showError() {
            $("#status").html('<i class="fas fa-times"></i>').css("color", "red");
        }

        function getResults(keyword) {
            showLoading();
            console.log(keyword)
            $.get(`${invokeUrl}/keyword/${keyword}`)
                .done(function (responseBody) {
                    console.log(responseBody);
                    showSuccess();
                    plots = ["yearPlot", "authorPlot", "categoryPlot"];
                    for (plot of plots) {
                        $("#" + plot).attr("src", "data:image/png;base64," + responseBody[plot]);
                    }
                    $("#response").html(JSON.stringify(responseBody['allPapers'], null, 2));
                })
                .fail(function (jqXHR, textStatus) {
                    console.log(textStatus);
                    showError();
                    $("#response").html(textStatus);
                });
        };

        $("#enterKeyword").keyup(function (event) {
            if (event.keyCode == 13) {
                this.blur();
                $("#submitKeyword").click();
            }
        });

        $("#submitKeyword").click(function () {
            this.blur();
            getResults($("#enterKeyword").val());
        });

        $("#darkTheme").click(function () {
            this.blur();
            $("body").toggleClass("dark-theme");
        });
    </script>
</body>

</html>